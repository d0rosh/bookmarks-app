var config={apiKey:"AIzaSyAgYBr-Oi2kCkj7EvdCanKOZJC9DqH2jpY",authDomain:"bookma-1cd0d.firebaseapp.com",databaseURL:"https://bookma-1cd0d.firebaseio.com",projectId:"bookma-1cd0d",storageBucket:"bookma-1cd0d.appspot.com",messagingSenderId:"966173985427"};firebase.initializeApp(config);var app=angular.module("app",["ngRoute","firebase","ngStorage","ngAnimate"]);app.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"/pages/home/home.html",controller:"homeCtrl",controllerAs:"ctrl",data:{private:!0},title:"Home"}),e.when("/settings",{templateUrl:"/pages/settings/settings.html",controller:"settingsCtrl",controllerAs:"ctrl",title:"Settings"}),e.otherwise({templateUrl:"/pages/error/error.html",title:"404 ERROR"})}]),app.run(["$rootScope",function(e){e.$on("$routeChangeStart",function(t,s,n){e.title=s.title})}]),app.factory("bkmServices",["$firebaseArray",function(e){return{saveBkm:function(t){var s=firebase.database().ref("bookmarks");e(s).$add(t)},updateBkm:function(e){var t=e.$id,s={title:e.title,url:e.url};firebase.database().ref("bookmarks/"+t).update(s)},getBkm:function(){return new Promise(function(t,s){var n=firebase.database().ref("bookmarks");t(e(n))})}}}]),app.factory("stgServices",["$localStorage",function(e){function t(){e.bg=s.bg,e.showBkm=s.showBkm,e.fsz=s.fsz,e.pzm=s.pzm}var s={bg:!0,showBkm:!0,fsz:"19px",pzm:"1"};return t(),{getSettings:function(){return{bg:e.bg,showBkm:e.showBkm,fsz:e.fsz,pzm:e.pzm}},setColor:function(t){e.bg=t},setVisibleBkb:function(t){e.showBkm=t},setFontSize:function(t){e.fsz=t},setPageZoom:function(t){e.pzm=t},resetToDefault:function(){t()}}}]),app.factory("userServices",["$firebaseArray",function(e){return{getUsers:function(){return new Promise(function(t,s){var n=firebase.database().ref("users");t(e(n))})},saveUser:function(t){var s=firebase.database().ref("users");e(s).$add(t)},updateUser:function(e){var t=e.$id,s={name:e.name,email:e.email};firebase.database().ref("users/"+t).update(s)},updateAvatar:function(e){var t=e.$id,s={img:e.img};firebase.database().ref("users/"+t).update(s)}}}]),app.directive("activeUser",function(){return{restrict:"A",link:function(e,t,s){var n=t.parent();t.bind("click",function(){"admin"==e.user.role&&(n.css("border-color","#42526e"),n.css("transition","0.6s"))}),e.$on("delborder",function(){n.css("border-color","#fff"),n.css("transition","0.6s")})}}}),app.directive("iAnimate",function(){return{restrict:"A",link:function(e,t,s){var n=t.parent().find("span");t.bind("focus",function(e){n.addClass("active-span"),t.addClass("active-input")}),t.bind("focusout",function(){0==t.val().length&&(n.removeClass("active-span"),t.removeClass("active-input"))}),e.$on("focusout",function(){n.removeClass("active-span"),t.removeClass("active-input")}),e.$on("focus",function(){n.addClass("active-span"),t.addClass("active-input")})}}}),app.directive("myLoader",function(){return{scope:{show:"="},restrict:"E",transclude:!1,replace:!1,templateUrl:"/directives/loader/loader.html"}}),app.controller("homeCtrl",["$firebaseArray","bkmServices","$timeout","$location","stgServices","$localStorage","$scope",function(e,t,s,n,r,o,a){var i=this;i.bookmarks=[],i.selectedItem={},i.noticeMsg="",i.showLoader=!0,t.getBkm().then(function(e){1==i.showBkm?s(function(){i.bookmarks=e,i.showLoader=!1},2e3):a.$apply(function(){i.showLoader=!1})});var c=r.getSettings();i.bg=c.bg,i.showBkm=c.showBkm;var u=c.pzm,l=c.fsz;i.pageStyle={zoom:u,"-moz-transform":"scale("+u+")","font-size":l},i.editItem=function(e){i.selectedItem=angular.copy(e),a.$broadcast("focus")},i.cancelUpdate=function(){i.selectedItem={},a.$broadcast("focusout")},i.saveItem=function(e){e.$id?(t.updateBkm(e),i.noticeMsg="Successfully updated!",console.log(i.noticeMsg),i.selectedItem={}):(t.saveBkm(e),i.noticeMsg="Successfully added",i.selectedItem={}),a.$broadcast("focusout")},i.goToStg=function(e){e.preventDefault(),e.target.classList.add("rotate"),s(function(){n.path("/settings")},1500)}}]),app.directive("notice",["$timeout",function(e){return{scope:{message:"="},restrict:"E",transclude:!1,replace:!1,templateUrl:"/directives/notice/notice.html",link:function(t,s,n){t.$watch("message",function(n,r){n&&(s.addClass("open"),e(function(){s.removeClass("open"),t.message=""},2e3))})}}}]),app.controller("settingsCtrl",["$firebaseArray","userServices","stgServices","$localStorage","$timeout","$scope","bkmServices","$window",function(e,t,s,n,r,o,a,i){var c=this,u=s.getSettings();c.users=[],c.newUser={},c.genders=["male","female"],c.roles=["user","admin"],c.userPopapVisib=!1,c.showInput=!1,c.currentUser={},c.noticeMsg="",c.showAvatars=!1,c.userAvatars=["boy.png","girl.png","girl1.png","girl2.png","man.png","man1.png","user.png","user1.png","user2.png"],c.bg=u.bg,c.newBookmark={},c.bookmarks=[],c.showBkm=u.showBkm,c.fsz=u.fsz,c.pzm=u.pzm,a.getBkm().then(function(e){c.bookmarks=e}),t.getUsers().then(function(e){c.users=e,o.$apply()}),c.changeBg=function(){s.setColor(c.bg)},c.saveUser=function(){"male"==c.newUser.gender?c.newUser.img="male.png":c.newUser.img="female.png",t.saveUser(c.newUser),c.userPopapVisib=!1,c.noticeMsg="Successfully added"},c.editUser=function(e){"admin"==e.role?(c.showInput=!0,c.currentUser=angular.copy(e),console.log(c.currentUser)):c.noticeMsg="This user has no rights to edit"},c.cancelEdit=function(){c.showInput=!1,c.currentUser={}},c.updateUser=function(){t.updateUser(c.currentUser),c.showInput=!1,c.currentUser={},c.noticeMsg="Successfully updated!"},c.openAvatarList=function(e){"admin"==e.role?(c.showAvatars=!0,c.currentUser=angular.copy(e)):(c.noticeMsg="This user has no rights to edit",c.showAvatars=!1,c.currentUser={}),o.$broadcast("delborder")},c.changeAvatar=function(e){c.currentUser.img=e,t.updateAvatar(c.currentUser),c.showAvatars=!1,c.currentUser={},c.noticeMsg="Successfully updated!",o.$broadcast("delborder")},c.saveItem=function(e){var t=e;t.url="",a.saveBkm(t),c.noticeMsg="Successfully added",c.newBookmark={},o.$broadcast("focusout")},c.visibleBkb=function(){s.setVisibleBkb(c.showBkm)},c.changeFsz=function(){s.setFontSize(c.fsz)},c.changePzm=function(){s.setPageZoom(c.pzm)},c.print=function(){var e=i.open("#!/","_blank","width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no");e.addEventListener("load",function(){e.print(),e.close()},!0)},c.reset=function(){s.resetToDefault(),u=s.getSettings(),c.bg=u.bg,c.showBkm=u.showBkm,c.fsz=u.fsz,c.pzm=u.pzm}}]);